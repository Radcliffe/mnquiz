<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minnesota Counties Learning Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .game-container {
            display: flex;
            gap: 30px;
            margin-top: 20px;
        }
        .map-container {
            width: 60%;
            max-width: 600px;
        }
        .options-container {
            width: 30%;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .stats {
            display: flex;
            justify-content: space-between;
            width: 90%;
            margin-bottom: 20px;
            font-size: 1.2rem;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
        }
        .option-btn {
            padding: 15px;
            font-size: 1.1rem;
            cursor: pointer;
            background-color: #e0e0e0;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        .option-btn:hover {
            background-color: #d0d0d0;
        }
        svg {
            width: 100%;
            height: auto;
        }
        /* .county {
            fill: #f0f0f0;
            stroke: #999;
            stroke-width: 0.5;
            transition: fill 0.3s;
        } */
        .county {
            fill: #f0f0f0;
            stroke: #333;  /* Darker border color */
            stroke-width: 30;  /* Thicker border */
            transition: fill 0.3s;
        }
        .highlight {
            fill: pink !important;
        }
        .correct {
            background-color: #a3e4a3 !important;
        }
        .incorrect {
            background-color: #e4a3a3 !important;
        }
        h1 {
            margin-bottom: 10px;
        }
        .game-message {
            height: 30px;
            font-size: 1.2rem;
            margin-top: 10px;
            text-align: center;
            font-weight: bold;
        }
        .controls {
            margin-top: 20px;
        }
        .new-game-btn {
            padding: 10px 20px;
            font-size: 1rem;
            background-color: #4a7dbd;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .new-game-btn:hover {
            background-color: #3a6dad;
        }
        .game-over {
            background-color: rgba(255, 0, 0, 0.1);
            padding: 20px;
            border-radius: 5px;
            text-align: center;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>Minnesota Counties Game</h1>
    <div class="stats">
        <div>Score: <span id="score">0</span></div>
        <div>High Score: <span id="high-score">0</span></div>
        <div>Lives: <span id="lives">3</span></div>
    </div>
    
    <div class="game-container">
        <div class="map-container" id="map-container"></div>
        
        <div class="options-container" id="options-container">
            <!-- County options will be added here dynamically -->
        </div>
    </div>
    
    <div class="game-message" id="game-message"></div>
    
    <div class="controls">
        <button class="new-game-btn" id="new-game-btn">New Game</button>
    </div>

    <script>
        // Game state
        let counties = [];
        let currentCounty = null;
        let score = 0;
        let highScore = localStorage.getItem('mnCountiesHighScore') || 0;
        let lives = 3;
        let gameActive = true;

        // DOM elements
        const mapContainer = document.getElementById('map-container');
        const optionsContainer = document.getElementById('options-container');
        const scoreElement = document.getElementById('score');
        const highScoreElement = document.getElementById('high-score');
        const livesElement = document.getElementById('lives');
        const gameMessageElement = document.getElementById('game-message');
        const newGameBtn = document.getElementById('new-game-btn');

        // Update display
        function updateStats() {
            scoreElement.textContent = score;
            highScoreElement.textContent = highScore;
            livesElement.textContent = lives;
        }

        // Initialize high score from localStorage
        highScoreElement.textContent = highScore;

        // Fetch county data and initialize game
        async function loadCountyData() {
            try {
                const response = await fetch('minnesota_counties.json');
                counties = await response.json();
                
                // Create SVG element and add counties
                createSvgMap();
                
                // Start the game
                startNewRound();
            } catch (error) {
                console.error('Error loading county data:', error);
                mapContainer.innerHTML = '<p>Error loading county data. Please refresh the page.</p>';
            }
        }

        // Create SVG map from county data
        function createSvgMap() {
            // Create SVG container
            const svgEl = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svgEl.setAttribute('viewBox', '-13347,-36535 57464,65388');
            svgEl.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
            
            // Add each county path
            counties.forEach(county => {
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('id', county.id);
                path.setAttribute('d', county.path);
                path.setAttribute('class', 'county');
                path.setAttribute('data-county', county.id);
                svgEl.appendChild(path);
            });
            
            mapContainer.appendChild(svgEl);
        }

        // Start a new round
        function startNewRound() {
            if (!gameActive) return;
            
            // Clear previous highlights and options
            clearHighlights();
            optionsContainer.innerHTML = '';
            gameMessageElement.textContent = '';
            
            // Randomly select a county
            currentCounty = counties[Math.floor(Math.random() * counties.length)];
            
            // Highlight the selected county
            const countyElement = document.getElementById(currentCounty.id);
            if (countyElement) {
                countyElement.classList.add('highlight');
            }
            
            // Generate options (1 correct, 3 random)
            generateOptions();
        }

        // Clear all highlights
        function clearHighlights() {
            document.querySelectorAll('.county').forEach(county => {
                county.classList.remove('highlight');
            });
        }

        // Generate answer options
        function generateOptions() {
            // Create array with correct answer
            const correctCountyName = currentCounty.id;
            const options = [correctCountyName];
            
            // Add 3 random wrong options
            while (options.length < 4) {
                const randomCounty = counties[Math.floor(Math.random() * counties.length)].id;
                // Ensure no duplicates
                if (!options.includes(randomCounty)) {
                    options.push(randomCounty);
                }
            }
            
            // Shuffle options
            shuffleArray(options);
            
            // Create buttons for each option
            options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = formatCountyName(option);
                button.className = 'option-btn';
                button.addEventListener('click', () => checkAnswer(option));
                optionsContainer.appendChild(button);
            });
        }

        // Format county name (replace underscores with spaces, capitalize)
        function formatCountyName(name) {
            return name
                .replace(/_/g, ' ')
                .replace(/\b\w/g, c => c.toUpperCase());
        }

        // Check if answer is correct
        function checkAnswer(selectedOption) {
            if (!gameActive) return;
            
            const buttons = document.querySelectorAll('.option-btn');
            const isCorrect = selectedOption === currentCounty.id;
            
            // Disable all buttons after selection
            buttons.forEach(button => {
                button.disabled = true;
                if (button.textContent === formatCountyName(currentCounty.id)) {
                    button.classList.add('correct');
                } else if (button.textContent === formatCountyName(selectedOption) && !isCorrect) {
                    button.classList.add('incorrect');
                }
            });
            
            // Update score or lives
            if (isCorrect) {
                score += 10;
                gameMessageElement.textContent = 'Correct!';
                
                // Update high score if needed
                if (score > highScore) {
                    highScore = score;
                    localStorage.setItem('mnCountiesHighScore', highScore);
                }
            } else {
                lives--;
                gameMessageElement.textContent = `Incorrect! That was ${formatCountyName(currentCounty.id)}.`;
                
                // Check if game over
                if (lives <= 0) {
                    endGame();
                    return;
                }
            }
            
            // Update display
            updateStats();
            
            // Start new round after delay
            setTimeout(startNewRound, 2000);
        }

        // End the game
        function endGame() {
            gameActive = false;
            // gameMessageElement.textContent = '';
            
            const gameOverMessage = document.createElement('div');
            gameOverMessage.className = 'game-over';
            gameOverMessage.innerHTML = `
                <h2>Game Over!</h2>
                <p>Your final score: ${score}</p>
                <p>High score: ${highScore}</p>
            `;
            
            document.querySelector('.game-container').appendChild(gameOverMessage);
        }

        // Start a new game
        function newGame() {
            // Remove game over message if present
            const gameOverMessage = document.querySelector('.game-over');
            if (gameOverMessage) {
                gameOverMessage.remove();
            }
            
            // Reset game state
            score = 0;
            lives = 3;
            gameActive = true;
            
            // Update display
            updateStats();
            
            // Start new round
            startNewRound();
        }

        // Utility function to shuffle array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Event listeners
        newGameBtn.addEventListener('click', newGame);

        // Initialize game
        loadCountyData();
    </script>
</body>
</html>
